# 🔧 环境变量修复指南

## 问题描述

在 Vite 项目中出现 `process is not defined` 错误，这是因为 Vite 不支持 Node.js 的 `process.env`，需要使用 `import.meta.env`。

## ✅ 已修复的问题

### 1. App.jsx 中的环境变量引用

**修复前：**
```javascript
youtubeApiKey={process.env.REACT_APP_YOUTUBE_API_KEY}
```

**修复后：**
```javascript
youtubeApiKey={import.meta.env.VITE_YOUTUBE_API_KEY}
```

## 🔧 Vite 环境变量规范

### 1. 环境变量前缀

Vite 中的环境变量必须以 `VITE_` 开头才能在客户端代码中访问：

```bash
# ✅ 正确 - 可以在前端访问
VITE_YOUTUBE_API_KEY=your_key_here
VITE_SERVER_URL=http://localhost:3001

# ❌ 错误 - 无法在前端访问
REACT_APP_YOUTUBE_API_KEY=your_key_here
YOUTUBE_API_KEY=your_key_here
```

### 2. 访问方式

```javascript
// ✅ Vite 中正确的访问方式
const apiKey = import.meta.env.VITE_YOUTUBE_API_KEY;
const serverUrl = import.meta.env.VITE_SERVER_URL;
const isDev = import.meta.env.DEV; // Vite 内置变量

// ❌ 在 Vite 中不可用
const apiKey = process.env.REACT_APP_YOUTUBE_API_KEY;
const nodeEnv = process.env.NODE_ENV;
```

### 3. 内置环境变量

Vite 提供了一些内置的环境变量：

```javascript
import.meta.env.MODE          // 'development' 或 'production'
import.meta.env.DEV           // boolean，开发模式时为 true
import.meta.env.PROD          // boolean，生产模式时为 true
import.meta.env.SSR           // boolean，服务端渲染时为 true
```

## 📝 环境变量配置

### 1. 创建环境变量文件

在 `packages/demo-app/` 目录下创建 `.env` 文件：

```bash
# .env
VITE_YOUTUBE_API_KEY=your_actual_youtube_api_key_here
VITE_SERVER_URL=http://localhost:3001
VITE_DEV_MODE=true
```

### 2. 不同环境的配置

```bash
# .env.development (开发环境)
VITE_SERVER_URL=http://localhost:3001
VITE_DEV_MODE=true

# .env.production (生产环境)
VITE_SERVER_URL=https://your-api-server.com
VITE_DEV_MODE=false
```

## 🚀 使用示例

### 1. 在组件中使用

```jsx
// App.jsx
function App() {
  const youtubeApiKey = import.meta.env.VITE_YOUTUBE_API_KEY;
  const serverUrl = import.meta.env.VITE_SERVER_URL || 'http://localhost:3001';
  
  return (
    <VideoEmbed
      url={videoUrl}
      youtubeApiKey={youtubeApiKey}
      serverUrl={serverUrl}
    />
  );
}
```

### 2. 条件渲染

```jsx
// 开发模式下显示调试信息
{import.meta.env.DEV && (
  <div className="debug-info">
    <p>开发模式</p>
    <p>API服务器: {import.meta.env.VITE_SERVER_URL}</p>
  </div>
)}
```

### 3. 类型安全（TypeScript）

如果使用 TypeScript，可以扩展环境变量类型：

```typescript
// vite-env.d.ts
interface ImportMetaEnv {
  readonly VITE_YOUTUBE_API_KEY: string;
  readonly VITE_SERVER_URL: string;
  readonly VITE_DEV_MODE: string;
}

interface ImportMeta {
  readonly env: ImportMetaEnv;
}
```

## 🔒 安全注意事项

### 1. 敏感信息保护

```bash
# ✅ 可以暴露的配置
VITE_SERVER_URL=http://localhost:3001
VITE_APP_NAME=H5 Video Embed

# ⚠️ 谨慎暴露的信息
VITE_YOUTUBE_API_KEY=your_key  # API密钥会暴露在客户端

# ❌ 绝不暴露的敏感信息
SECRET_KEY=your_secret         # 不以VITE_开头，不会暴露
DATABASE_PASSWORD=password     # 敏感信息应该在后端处理
```

### 2. 最佳实践

1. **API密钥限制**：为前端使用的API密钥设置域名和引用限制
2. **环境分离**：不同环境使用不同的API密钥
3. **版本控制**：将 `.env` 文件添加到 `.gitignore`

```bash
# .gitignore
.env
.env.local
.env.*.local
```

## 🧪 验证修复

### 1. 启动应用

```bash
cd packages/demo-app
npm run dev
```

### 2. 检查控制台

应该不再出现 `process is not defined` 错误。

### 3. 测试环境变量

在浏览器控制台中输入：

```javascript
console.log(import.meta.env);
```

应该能看到所有以 `VITE_` 开头的环境变量。

## 🔄 迁移清单

如果从 Create React App 迁移到 Vite，需要：

- [ ] 将 `REACT_APP_*` 重命名为 `VITE_*`
- [ ] 将 `process.env.*` 替换为 `import.meta.env.*`
- [ ] 更新环境变量文件
- [ ] 测试所有使用环境变量的功能

## ✅ 修复完成

现在环境变量问题已经修复，应用应该可以正常运行了！🎉
