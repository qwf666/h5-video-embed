# 🧪 国内视频平台测试用例

## 抖音测试

### 测试用例 1: 普通抖音视频
```bash
curl -X POST http://localhost:3001/api/video/parse \
  -H "Content-Type: application/json" \
  -d '{"url":"https://www.douyin.com/video/7234567890123456789"}'
```

### 测试用例 2: 抖音分享链接
```bash
curl -X POST http://localhost:3001/api/video/parse \
  -H "Content-Type: application/json" \
  -d '{"url":"https://v.douyin.com/iRNBho6L/"}'
```

**期望结果：**
- ✅ 视频标题和描述
- ✅ 作者信息
- ✅ 播放量、点赞量等统计数据
- ✅ 视频缩略图
- ✅ 背景音乐信息
- ✅ 话题标签

## B站测试

### 测试用例 3: B站普通视频
```bash
curl -X POST http://localhost:3001/api/video/parse \
  -H "Content-Type: application/json" \
  -d '{"url":"https://www.bilibili.com/video/BV1xx411c7mu"}'
```

### 测试用例 4: B站短链接
```bash
curl -X POST http://localhost:3001/api/video/parse \
  -H "Content-Type: application/json" \
  -d '{"url":"https://b23.tv/BV1xx411c7mu"}'
```

**期望结果：**
- ✅ 完整视频信息
- ✅ UP主信息
- ✅ 播放量、点赞、投币、收藏数据
- ✅ 弹幕数量
- ✅ 多P视频支持
- ✅ 标签和分区信息

## 腾讯视频测试

### 测试用例 5: 腾讯视频
```bash
curl -X POST http://localhost:3001/api/video/parse \
  -H "Content-Type: application/json" \
  -d '{"url":"https://v.qq.com/x/cover/mzc00200mp8lnv8/z0043x8jqaw.html"}'
```

**期望结果：**
- ✅ 视频基本信息
- ✅ 剧集信息（如果是电视剧/综艺）
- ✅ 视频时长
- ✅ 缩略图

## 西瓜视频测试

### 测试用例 6: 西瓜视频
```bash
curl -X POST http://localhost:3001/api/video/parse \
  -H "Content-Type: application/json" \
  -d '{"url":"https://www.ixigua.com/1234567890123456789"}'
```

**期望结果：**
- ✅ 视频信息和描述
- ✅ 创作者信息
- ✅ 播放量等统计数据
- ✅ 标签信息

## 快手测试

### 测试用例 7: 快手视频
```bash
curl -X POST http://localhost:3001/api/video/parse \
  -H "Content-Type: application/json" \
  -d '{"url":"https://www.kuaishou.com/short-video/3xiqjreqm4c4rm8"}'
```

**期望结果：**
- ✅ 视频标题和描述
- ✅ 用户信息
- ✅ 视频时长
- ✅ 缩略图

## 平台优先级测试

### 测试用例 8: 检查平台识别
```bash
# 获取支持的平台列表
curl http://localhost:3001/api/platforms
```

### 测试用例 9: 错误处理
```bash
curl -X POST http://localhost:3001/api/video/parse \
  -H "Content-Type: application/json" \
  -d '{"url":"https://invalid-url.com/video/123"}'
```

## 性能测试

### 测试用例 10: 并发请求
```bash
# 同时发起多个请求测试并发处理能力
for i in {1..5}; do
  curl -X POST http://localhost:3001/api/video/parse \
    -H "Content-Type: application/json" \
    -d '{"url":"https://www.bilibili.com/video/BV1xx411c7mu"}' &
done
wait
```

## 预期响应格式

### 国内平台标准响应
```json
{
  "success": true,
  "data": {
    "id": "视频ID",
    "title": "视频标题",
    "description": "视频描述",
    "duration": 180,
    "thumbnail": "缩略图URL",
    "uploader": "上传者昵称",
    "uploader_id": "上传者ID",
    "upload_date": "20231201",
    "view_count": 1000000,
    "like_count": 50000,
    "comment_count": 1000,
    "share_count": 500,
    "formats": [
      {
        "format_id": "platform_quality",
        "url": "播放地址",
        "ext": "mp4",
        "quality": 720,
        "width": 1280,
        "height": 720,
        "fps": 30,
        "vcodec": "h264",
        "acodec": "aac"
      }
    ],
    "webpage_url": "原始链接",
    "extractor": "平台名称",
    "platform": "显示名称",
    "tags": ["标签1", "标签2"]
  },
  "message": "视频解析成功"
}
```

### 错误响应
```json
{
  "success": false,
  "message": "具体错误信息",
  "error": "详细错误堆栈（开发模式）"
}
```

## 测试脚本

### 批量测试脚本
```bash
#!/bin/bash
echo "🧪 开始国内视频平台测试..."

# 测试URL数组
declare -a urls=(
  "https://www.douyin.com/video/test"
  "https://www.bilibili.com/video/BV1xx411c7mu"
  "https://v.qq.com/x/cover/test.html"
  "https://www.ixigua.com/1234567890"
  "https://www.kuaishou.com/short-video/test"
)

# 遍历测试
for url in "${urls[@]}"; do
  echo "测试: $url"
  curl -X POST http://localhost:3001/api/video/parse \
    -H "Content-Type: application/json" \
    -d "{\"url\":\"$url\"}" \
    -w "\n状态码: %{http_code}\n响应时间: %{time_total}s\n\n"
done

echo "✅ 测试完成"
```

## 注意事项

1. **网络依赖**: 某些API需要稳定的网络连接
2. **反爬虫**: 部分平台有反爬虫机制，可能需要调整请求头
3. **URL格式**: 确保测试URL格式正确
4. **API限制**: 某些平台API可能有调用频率限制
5. **内容限制**: 私有或已删除的视频无法解析

## 故障排除

### 常见问题
1. **网络超时**: 增加超时时间或检查网络连接
2. **API变更**: 视频平台API可能发生变化，需要及时更新
3. **格式不支持**: 某些特殊格式视频可能无法解析
4. **地区限制**: 部分内容可能有地区访问限制
